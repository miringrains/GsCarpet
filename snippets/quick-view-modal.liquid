{% comment %}
  Quick View Modal
  Displays product information in a modal overlay
{% endcomment %}

<div 
  class="quick-view-modal"
  x-data="quickViewModal()"
  x-show="$store.quickView.isOpen"
  x-cloak
  @keydown.escape.window="$store.quickView.close()"
>
  <!-- Overlay -->
  <div 
    class="quick-view-modal__overlay"
    x-show="$store.quickView.isOpen"
    x-transition:enter="transition ease-out duration-300"
    x-transition:enter-start="opacity-0"
    x-transition:enter-end="opacity-1"
    x-transition:leave="transition ease-in duration-200"
    x-transition:leave-start="opacity-1"
    x-transition:leave-end="opacity-0"
    @click="$store.quickView.close()"
  ></div>

  <!-- Modal Content -->
  <div 
    class="quick-view-modal__content"
    x-show="$store.quickView.isOpen"
    x-transition:enter="transition ease-out duration-300"
    x-transition:enter-start="opacity-0 scale-90"
    x-transition:enter-end="opacity-1 scale-100"
    x-transition:leave="transition ease-in duration-200"
    x-transition:leave-start="opacity-1 scale-100"
    x-transition:leave-end="opacity-0 scale-90"
    @click.stop
  >
    <!-- Close Button -->
    <button 
      class="quick-view-modal__close"
      @click="$store.quickView.close()"
      aria-label="Close quick view"
    >
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
        <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="1.5"/>
      </svg>
    </button>

    <!-- Loading State -->
    <div 
      class="quick-view-modal__loading"
      x-show="loading"
    >
      <div class="quick-view-modal__spinner"></div>
    </div>

    <!-- Product Content -->
    <div 
      class="quick-view-modal__product"
      x-show="!loading && product"
    >
      <div class="quick-view-modal__layout">
        <!-- Product Images -->
        <div class="quick-view-modal__images">
          <div class="quick-view-modal__main-image">
            <template x-if="product && product.featured_image">
              <img 
                :src="product.featured_image"
                :alt="product.title"
                class="quick-view-modal__img"
              >
            </template>
          </div>
          
          <!-- Thumbnails -->
          <div 
            class="quick-view-modal__thumbnails"
            x-show="product && product.images && product.images.length > 1"
          >
            <template x-for="(image, index) in (product ? product.images : [])" :key="index">
              <button 
                class="quick-view-modal__thumb"
                :class="{ 'quick-view-modal__thumb--active': selectedImageIndex === index }"
                @click="selectedImageIndex = index"
              >
                <img :src="image" :alt="`${product.title} - Image ${index + 1}`">
              </button>
            </template>
          </div>
        </div>

        <!-- Product Info -->
        <div class="quick-view-modal__info">
          <h2 class="quick-view-modal__title" x-text="product ? product.title : ''"></h2>
          
          <!-- Price -->
          <div class="quick-view-modal__price">
            <template x-if="product && product.compare_at_price > product.price">
              <span class="quick-view-modal__price--compare" x-text="`$${(product.compare_at_price / 100).toFixed(2)}`"></span>
            </template>
            <span class="quick-view-modal__price--current" x-text="product ? `$${(product.price / 100).toFixed(2)}` : ''"></span>
          </div>

          <!-- Material -->
          <template x-if="product && product.material">
            <div class="quick-view-modal__material">
              <span class="badge">{{ product.material }}</span>
            </div>
          </template>

          <!-- Description -->
          <div 
            class="quick-view-modal__description"
            x-html="product ? product.description : ''"
          ></div>

          <!-- Actions -->
          <div class="quick-view-modal__actions">
            <a 
              :href="product ? product.url : '#'"
              class="btn btn--primary btn--large"
            >
              Customize Size
            </a>
            
            <a 
              :href="product ? product.url : '#'"
              class="btn btn--secondary"
            >
              View Full Details
            </a>
          </div>

          <!-- Features -->
          <div class="quick-view-modal__features">
            <div class="quick-view-modal__feature">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                <path d="M17 8.5L7.25 18.25L2 13" stroke="currentColor" stroke-width="1.5"/>
              </svg>
              <span>Free Shipping</span>
            </div>
            <div class="quick-view-modal__feature">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                <path d="M17 8.5L7.25 18.25L2 13" stroke="currentColor" stroke-width="1.5"/>
              </svg>
              <span>30-Day Returns</span>
            </div>
            <div class="quick-view-modal__feature">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                <path d="M17 8.5L7.25 18.25L2 13" stroke="currentColor" stroke-width="1.5"/>
              </svg>
              <span>Custom Sizes Available</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  /* Quick View Modal Styles */
  .quick-view-modal {
    position: fixed;
    inset: 0;
    z-index: var(--z-index-modal);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: var(--space-md);
  }

  .quick-view-modal__overlay {
    position: absolute;
    inset: 0;
    background-color: rgba(0, 0, 0, 0.75);
  }

  .quick-view-modal__content {
    position: relative;
    width: 100%;
    max-width: 1000px;
    max-height: 90vh;
    background-color: var(--color-surface);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-2xl);
    overflow: hidden;
  }

  .quick-view-modal__close {
    position: absolute;
    top: var(--space-md);
    right: var(--space-md);
    z-index: 10;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 2.5rem;
    height: 2.5rem;
    background-color: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-full);
    cursor: pointer;
    transition: var(--transition-base);
  }

  .quick-view-modal__close:hover {
    background-color: var(--color-background-subtle);
  }

  /* Loading State */
  .quick-view-modal__loading {
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 400px;
  }

  .quick-view-modal__spinner {
    width: 3rem;
    height: 3rem;
    border: 3px solid var(--color-border);
    border-top-color: var(--color-accent);
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  /* Product Layout */
  .quick-view-modal__product {
    max-height: 90vh;
    overflow-y: auto;
  }

  .quick-view-modal__layout {
    display: grid;
    grid-template-columns: 1fr 1fr;
    min-height: 500px;
  }

  @media (max-width: 768px) {
    .quick-view-modal__layout {
      grid-template-columns: 1fr;
    }
  }

  /* Images */
  .quick-view-modal__images {
    padding: var(--space-xl);
    background-color: var(--color-background-subtle);
  }

  .quick-view-modal__main-image {
    margin-bottom: var(--space-md);
    aspect-ratio: 1;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .quick-view-modal__img {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }

  .quick-view-modal__thumbnails {
    display: flex;
    gap: var(--space-sm);
    justify-content: center;
    flex-wrap: wrap;
  }

  .quick-view-modal__thumb {
    width: 60px;
    height: 60px;
    padding: 0;
    border: 2px solid transparent;
    border-radius: var(--radius-sm);
    overflow: hidden;
    cursor: pointer;
    transition: var(--transition-base);
  }

  .quick-view-modal__thumb--active {
    border-color: var(--color-accent);
  }

  .quick-view-modal__thumb img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  /* Product Info */
  .quick-view-modal__info {
    padding: var(--space-xl);
    display: flex;
    flex-direction: column;
    gap: var(--space-md);
  }

  .quick-view-modal__title {
    font-size: 1.875rem;
    font-weight: 500;
    line-height: 1.2;
    color: var(--color-text-primary);
  }

  .quick-view-modal__price {
    display: flex;
    align-items: baseline;
    gap: var(--space-sm);
    font-size: 1.5rem;
  }

  .quick-view-modal__price--compare {
    text-decoration: line-through;
    color: var(--color-text-secondary);
    font-size: 1.25rem;
  }

  .quick-view-modal__price--current {
    font-weight: 500;
    color: var(--color-text-primary);
  }

  .quick-view-modal__description {
    color: var(--color-text-secondary);
    line-height: 1.6;
  }

  .quick-view-modal__actions {
    display: flex;
    gap: var(--space-sm);
    padding-top: var(--space-sm);
  }

  @media (max-width: 480px) {
    .quick-view-modal__actions {
      flex-direction: column;
    }
    
    .quick-view-modal__actions .btn {
      width: 100%;
    }
  }

  .quick-view-modal__features {
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
    padding-top: var(--space-md);
    border-top: 1px solid var(--color-border);
  }

  .quick-view-modal__feature {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    color: var(--color-text-secondary);
    font-size: 0.875rem;
  }

  .quick-view-modal__feature svg {
    flex-shrink: 0;
    color: var(--color-success);
  }
</style>